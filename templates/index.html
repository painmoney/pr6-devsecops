<!DOCTYPE html>
<html>
<head>
    <title>–ú–æ–∏ –∑–∞–º–µ—Ç–∫–∏ (Secure)</title>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .note { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .flash { background: #d4edda; color: #155724; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .error { background: #f8d7da; color: #721c24; padding: 10px; margin: 10px 0; border-radius: 5px; }
        form { margin: 20px 0; }
        input, textarea { width: 100%; margin: 5px 0; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        nav { background: #343a40; padding: 10px; margin-bottom: 20px; border-radius: 5px; }
        nav a { color: white; margin-right: 15px; text-decoration: none; }
        nav a:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <nav>
        {% if session.username %}
            <strong>–í—ã –≤–æ—à–ª–∏ –∫–∞–∫: {{ session.username }}</strong> | 
            <a href="/logout">–í—ã–π—Ç–∏</a>
        {% else %}
            <a href="/login">–í–æ–π—Ç–∏</a> | 
            <a href="/register">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
        {% endif %}
        | <a href="/test-sql">–¢–µ—Å—Ç SQL</a>
        | <a href="/test-sql-get?id=1">–¢–µ—Å—Ç SQL GET</a>
    </nav>
    
    <h1>üìù –ú–æ–∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏</h1>
    
    {% with messages = get_flashed_messages() %}
        {% if messages %}
            <div class="flash">
                {% for message in messages %}
                    {{ message }}<br>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}
    
    {% if session.user_id %}
        <h2>‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É</h2>
        <form method="POST" action="/add">
            {{ form.hidden_tag() }}
            {{ form.title(placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫ –∑–∞–º–µ—Ç–∫–∏") }}<br>
            {{ form.content(placeholder="–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏", rows=4) }}<br>
            <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–º–µ—Ç–∫—É</button>
        </form>
        
        <hr>
        
        <h2>üìã –ú–æ–∏ –∑–∞–º–µ—Ç–∫–∏</h2>
        {% if notes %}
            {% for note in notes %}
                <div class="note">
                    <h3>{{ note.title }}</h3>
                    <p>{{ note.content }}</p>
                    <small>–°–æ–∑–¥–∞–Ω–æ: {{ note.created_at.strftime('%d.%m.%Y %H:%M') }}</small>
                </div>
            {% endfor %}
        {% else %}
            <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–º–µ—Ç–æ–∫. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é!</p>
        {% endif %}
    {% else %}
        <div style="text-align: center; margin-top: 50px;">
            <h2>üîí –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h2>
            <p>–î–ª—è —Ä–∞–±–æ—Ç—ã —Å –∑–∞–º–µ—Ç–∫–∞–º–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ <a href="/login">–≤–æ–π—Ç–∏</a> –∏–ª–∏ <a href="/register">–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>.</p>
            <p>–≠—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π, CSRF –∞—Ç–∞–∫ –∏ —Å —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –ø–∞—Ä–æ–ª–µ–π.</p>
        </div>
    {% endif %}
    
    <footer style="margin-top: 50px; border-top: 1px solid #ddd; padding-top: 20px; font-size: 0.9em; color: #666;">
        <p>–ü–† ‚Ññ6: DevSecOps –∏ –ø–ª–∞–Ω –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ | –ó–∞—â–∏—â—ë–Ω–Ω–æ–µ Flask-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</p>
    </footer>
</body>
</html>